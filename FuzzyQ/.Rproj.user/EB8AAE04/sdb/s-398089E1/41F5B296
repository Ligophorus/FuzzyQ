{
    "collab_server" : "",
    "contents" : "# Comparison of common-rare helminth species AORs of\n# Planiliza haematocheilus\n# Japan Sea (native area) - Sea of Azov (introduced area)\nlibrary(FuzzyQ)\ndata(Azov) # helminth sp. abundance dataset 12 surveys Azov\ndata(Japan) # idem 7 surveys Japan\n\n# Silhouette barplots\n# Get silhouette widths per sp. per survey in both areas:\nfuzzyq.azov <- by(Azov[, -1], Azov[, \"sample\"], fuzzyq, rm.absent = FALSE)\nspp.azov <- lapply(fuzzyq.azov, function(x) x$spp)\n\nfuzzyq.japan <- by(Japan[, -1], Japan[, \"sample\"], fuzzyq, rm.absent = FALSE)\nspp.japan <- lapply(fuzzyq.japan, function(x) x$spp)\n\n# Ad hoc function to plot silhouette widths\nsil.barplot <- function(M, maint, col.bars=c(\"brown2\", \"turquoise3\"),...) {\n  barplot(M[,2], col=col.bars[M[,1]+1], main=maint, names.arg= rownames(M),...)\n}\n# Plot silhouette widths\n# Azov\npar(mfcol=c(4,3), mar = c(2.5, 1, 1.5, 1), oma=c(0,2.5,0,0), cex.axis=0.8,\n    las=2, mgp=c(3,0.5,0), font.main=1)\nazov.barplot <- mapply(sil.barplot, spp.azov, levels(Azov$sample))\nmtext(\"Silouhette widths\", side =2, line= 1, outer=TRUE,\n      at= c(0.13,0.381, 0.633,0.875), las=3, cex=0.6)\n# Japan\npar(mfcol=c(4,2), mar = c(2.5, 1, 1.5, 1), oma=c(0,2.5,0,0), cex.axis=0.8,\n    las=2, mgp=c(3,0.5,0), font.main=1)\njapan.barplot <- mapply(sil.barplot, spp.japan, levels(Japan$sample))\nmtext(\"Silouhette widths\", side =2, line= 1, outer=TRUE,\n      at= c(0.125,0.381, 0.63,0.882), las=3, cex=0.8)\n\n# Collate global estimates per survey\nglobal.azov <- t(sapply(fuzzyq.azov, function(x) x$global))\nglobal.japan <- t(sapply(fuzzyq.japan, function(x) x$global))\n## join\nglobal.all <- as.data.frame(rbind(global.azov,global.japan))\nglobal.all$Area <- as.factor(c(rep(\"Azov\", nrow(global.azov)),\n                               rep(\"Japan\", nrow(global.japan))))\n\n# Test differences in parameters between areas\n# Global average silhouette width:\n    wilcox.test(silw.all ~ Area, data = global.all)\n# Common species average silhouette width:\n    wilcox.test(silw.com ~ Area, data = global.all)\n# Rare species average silhouette width\n    wilcox.test(silw.rar ~ Area, data = global.all)\n# Normalized Dunn's index:\nwilcox.test(N.Dunn ~ Area, data = global.all)\n# Common species average Commonness index:\n    wilcox.test(commI.com ~ Area, data = global.all)\n# Rare species average Commonness index:\n    wilcox.test(commI.rar ~ Area, data = global.all)\n\n# Compute 95% confidence intervals of global parameters by bootstrap\nNboot =1e3 # set no. bootstrap replicates\nset.seed(2020) # randomization seed - optional\n\nBSazov <- by(Azov[, -1], Azov[, \"sample\"], fuzzyqBoot, N = Nboot,\n             level= \"global\")\n#\nBSazov <- lapply(seq_len(length(BSazov)),\n                 function(x) fuzzyqCI(BSazov[[x]],\n                             fuzzyq.azov[[x]], method = \"bca\"))\n\n#\nBSjapan <- by(Japan[, -1], Japan[, \"sample\"], fuzzyqBoot,\n              N = Nboot, level = \"global\")\n           # increase number iterations (maxit) to reach convergence\nBSjapan <- lapply(seq_len(length(BSjapan)), function(x) fuzzyqCI(BSjapan[[x]],\n                  fuzzyq.japan[[x]], method = \"bca\"))\n# Collate results from both areas\nBSall <- c(BSazov, BSjapan)\n\n# To plot estimates +- 95% CIs:\n# Prepare data for boxplots\nsilw.all <- cbind(sapply(BSall, function(x) x[, \"silw.all\"]))\nsilw.com <- cbind(sapply(BSall, function(x) x[, \"silw.com\"]))\nsilw.rar <- cbind(sapply(BSall, function(x) x[, \"silw.rar\"]))\nN.Dunn <- cbind(sapply(BSall, function(x) x[, \"N.Dunn\"]))\ncommI.com <- cbind(sapply(BSall, function(x) x[, \"commI.com\"]))\ncommI.rar <- cbind(sapply(BSall, function(x) x[, \"commI.rar\"]))\n\n# 2 colors by area to plot results\ncol.AJ <- c(\"darkorange2\", \"slategray\")\ncol.tag <- col.AJ[global.all$Area]\n# Plot estimates +- 95% confidence intervals\npar(mfcol=c(3,2), mar = c(0.2, 6, 0.5, 1), oma=c(3.5,0.25,0,0), cex.axis=0.8)\nplot(global.all$silw.all, col=col.tag, ylab=\"Average silhouette width\",\n    xlab=\"\", xaxt='n', pch=16, ylim=c(min(silw.all),max(silw.all)))\n  arrows(1:nrow(global.all),silw.all[1,],1:nrow(global.all),silw.all[2,],\n       length=0, angle=90, code=3, col=col.tag)\nplot(global.all$silw.com, col=col.tag, ylab=\"Average silhouette width\",\n    xlab=\"\", xaxt='n', pch=16, ylim=c(min(silw.com),max(silw.com)))\n  arrows(1:nrow(global.all),silw.com[1,],1:nrow(global.all),silw.com[2,],\n       length=0, angle=90, code=3, col=col.tag)\nplot(global.all$silw.rar, col=col.tag, ylab=\"Average silhouette width\",\n    xlab=\"\", xaxt='n', pch=16, ylim=c(min(silw.rar), max(silw.rar)))\n  arrows(1:nrow(global.all),silw.rar[1,],1:nrow(global.all),silw.rar[2,],\n         length=0, angle=90, code=3, col=col.tag)\n  axis(side=1, at=1:nrow(global.all),rownames(global.all), las=2)\nplot(global.all$N.Dunn, col=col.tag, ylab=\"Normalized Dunn's coefficient\",\n    xlab=\"\", xaxt='n', pch=16, ylim=c(min(N.Dunn),max(N.Dunn)))\n  arrows(1:nrow(global.all), N.Dunn[1,],1:nrow(global.all),N.Dunn[2,],\n         length=0, angle=90, code=3, col=col.tag)\nlegend(16, 0.9, c(\"Azov\", \"Japan\"), col = col.AJ, pch = 16)\nplot(global.all$commI.com, col=col.tag, ylab=\"Average commonness index\",\n       xlab=\"\", xaxt='n', pch=16, ylim=c(min(commI.com),max(commI.com)))\n  arrows(1:nrow(global.all), commI.com[1,],1:nrow(global.all),commI.com[2,],\n         length=0, angle=90, code=3, col=col.tag)\nplot(global.all$commI.rar, col=col.tag, ylab=\"Average commonness index\",\n       xlab=\"\", xaxt='n', pch=16, ylim=c(min(commI.rar),max(commI.rar)))\n  arrows(1:nrow(global.all), commI.rar[1,],1:nrow(global.all),commI.rar[2,],\n         length=0, angle=90, code=3, col=col.tag)\n  axis(side=1, at=1:nrow(global.all),rownames(global.all), las=2)\nmtext(\"Survey\", side = 1, line = 2, outer = TRUE, at = c(0.30, 0.80), las = 1)\n\n",
    "created" : 1600247922680.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4129509672",
    "id" : "41F5B296",
    "lastKnownWriteTime" : 1600250136,
    "last_content_update" : 1600250136972,
    "path" : "F:/nuvol/FuzzyQ/FuzzyQ/docs/HelminthsPlaniliza_haematocheilus_example.R",
    "project_path" : "docs/HelminthsPlaniliza_haematocheilus_example.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}